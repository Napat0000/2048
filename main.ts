function GetAction (Dx: number, Dy: number, Loop: number) {
    MoveAndLoop(Dx, Dy, Loop)
    NewBlock()
    TheGameplayIsOver()
}
function Bootup () {
    scene.setBackgroundImage(img`
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        `)
    spriteutils.drawTransparentImage(img`
        ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
        fffffffffffffffffffffffff111111111111111ffffffffffffffffffffffff
        fffffffffffffffffffff11111111111111111111111ffffffffffffffffffff
        fffffffffffffffffff111111111111111111111111111ffffffffffffffffff
        fffffffffffffffff1111111111111111111111111111111ffffffffffffffff
        fffffffffffffff1111111111fffffffffffffff1111111111ffffffffffffff
        ffffffffffffff11111111fffffffffffffffffffff11111111fffffffffffff
        fffffffffffff1111111fffffffffffffffffffffffff1111111ffffffffffff
        fffffffffff1111111fffffffffffffffffffffffffffff1111111ffffffffff
        ffffffffff111111fffffffffffffffffffffffffffffffff111111fffffffff
        fffffffff111111fffffffffffffffffffffffffffffffffff111111ffffffff
        ffffffff111111fffffffffffffffffffffffffffffffffffff111111fffffff
        ffffffff11111fffffffffffffffffffffffffffffffffffffff11111fffffff
        fffffff11111fffffffffffffffffffffffffffffffffffffffff11111ffffff
        ffffff11111fffffffffffffffffffffffffffffffffffffffffff11111fffff
        fffff11111fffffffffffffffffffffffffffffffffffffffffffff11111ffff
        fffff1111fffffffffffffffffffffffffffffffffffffffffffffff1111ffff
        ffff11111fffffffffffffffffffffffffffffffffffffffffffffff11111fff
        ffff1111fffffffffffffffffffffffffffffffffffffffffffffffff1111fff
        fff11111fffffffffffffffffffffffffffffffffffffffffffffffff11111ff
        fff1111ffffffff1111111111111111111fff1111ffff11111ffffffff1111ff
        ff11111fffffff111111111111111111111f111111ff1111111fffffff11111f
        ff1111ffffffff11fffffffffffffffff11f11ff11ff11fff11ffffffff1111f
        ff1111ffffffff11fffffffffff11ffff11f11ff11ff11fff11ffffffff1111f
        ff1111ffffffff11fffffffffff11ffff11f11ff11ff11fff11ffffffff1111f
        f1111fffffffff1111111111fff11111111f11ff11ff1111111fffffffff1111
        f1111ffffffffff1111111111ff1111111ff11ff11ff1111111fffffffff1111
        f1111ffffffffffffffffff11ff11fffffff11ff11ff11ff111fffffffff1111
        f1111ffffffffffffffffff11ff11fffffff11ff11ff11ff111fffffffff1111
        f1111ffffffffffffffffff11ff11fffffff11ff11ff11ff111fffffffff1111
        f1111fffffffff11111111111ff11111111111ff111111ff111fffffffff1111
        f1111fffffffff1111111111ffff111111111ffff1111ffff11fffffffff1111
        f1111fffffffff11ffffffffffffffffffffffffffffffffffffffffffff1111
        f1111fffffffff11ffffffffffffffffffffffffffffffffffffffffffff1111
        f1111fffffffff111111f1111fff111111fff1111ffff11111ffffffffff1111
        f1111fffffffff111111111111f11111111f111111ff1111111fffffffff1111
        f1111fffffffff111ff111ff11f11ffff11f11ff11ff11fff11fffffffff1111
        f1111fffffffff111ff111ff11f111fff11f11ff11ff11fff11fffffffff1111
        f1111fffffffff111ff111ff11f111fff11f11ff11ff11fff11fffffffff1111
        f1111fffffffff111ff111ff11f11111111f11ff11ff1111111fffffffff1111
        ff1111ffffffff111ff111ff11f1111111ff11ff11ff1111111ffffffff1111f
        ff1111ffffffff111ff111ff11f111ffffff11ff11ff11ff111ffffffff1111f
        ff1111ffffffff111ff111ff11f111ffffff11ff11ff11ff111ffffffff1111f
        ff11111fffffff111ff111ff11111111111111ff111111ff111fffffff11111f
        fff1111fffffff11ffff1ffff111f11111111ffff1111ffff11fffffff1111ff
        fff11111fffffffffffffffffffffffffffffffffffffffffffffffff11111ff
        ffff1111fffffffffffffffffffffffffffffffffffffffffffffffff1111fff
        ffff11111fffffffffffffffffffffffffffffffffffffffffffffff11111fff
        fffff1111fffffffffffffffffffffffffffffffffffffffffffffff1111ffff
        fffff11111fffffffffffffffffffffffffffffffffffffffffffff11111ffff
        ffffff11111fffffffffffffffffffffffffffffffffffffffffff11111fffff
        fffffff11111fffffffffffffffffffffffffffffffffffffffff11111ffffff
        ffffffff11111fffffffffffffffffffffffffffffffffffffff11111fffffff
        ffffffff111111fffffffffffffffffffffffffffffffffffff111111fffffff
        fffffffff111111fffffffffffffffffffffffffffffffffff111111ffffffff
        ffffffffff111111fffffffffffffffffffffffffffffffff111111fffffffff
        fffffffffff1111111fffffffffffffffffffffffffffff1111111ffffffffff
        fffffffffffff1111111fffffffffffffffffffffffff1111111ffffffffffff
        ffffffffffffff11111111fffffffffffffffffffff11111111fffffffffffff
        fffffffffffffff1111111111fffffffffffffff1111111111ffffffffffffff
        fffffffffffffffff1111111111111111111111111111111ffffffffffffffff
        fffffffffffffffffff111111111111111111111111111ffffffffffffffffff
        fffffffffffffffffffff11111111111111111111111ffffffffffffffffffff
        fffffffffffffffffffffffff111111111111111ffffffffffffffffffffffff
        `, scene.backgroundImage(), 80 - 32, 60 - 32)
    pause(900)
    scene.setBackgroundImage(img`
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        `)
    Booted = true
}
function SaveTable (Name: string) {
    SaveCode = ""
    SaveTime = SaveTime + (game.runtime() - StartTime)
    WriteNumber(SaveTime)
    WriteNumber(2048)
    WriteModuleGrid()
    if (blockSettings.exists(Name)) {
        if (SaveCode == blockSettings.readString(Name)) {
            return
        }
        blockSettings.writeString(Name, SaveCode)
    } else {
        blockSettings.writeString(Name, SaveCode)
    }
    StartTime = game.runtime()
}
spriteutils.createRenderable(0, function (screen2) {
    if (Booted && StartGame) {
        RenderGrid(screen2)
    }
})
function ReadNumber () {
    Val = 0
    SaveValue = ""
    Sloop = parseFloat(SaveCode.charAt(Sidx))
    for (let index = 0; index < Sloop; index++) {
        Sidx += 1
        C = SaveCode.charAt(Sidx)
        SaveValue = "" + SaveValue + C
    }
    Sidx += 1
    Val = parseFloat(SaveValue)
    if (SaveValue.charAt(0) == "0") {
        Val = 0 - Val
    }
}
function PaintTable () {
    for (let index = 0; index <= Gwidth * Gheight - 1; index++) {
        Gy = OffsetY
        Gy += Math.floor(index / Gwidth)
        Gx = OffsetX
        Gx += index % Gwidth
        tiles.setTileAt(tiles.getTileLocation(Gx, Gy), assets.tile`myTile0`)
        if (Grid[index] < 0) {
            tiles.setTileAt(tiles.getTileLocation(Gx, Gy), assets.tile`myTile`)
        }
    }
}
function TheGameplayIsOver () {
    GameOver = true
    for (let index = 0; index <= Gwidth * Gheight - 1; index++) {
        if (Grid[index] > 0) {
            FindLastChange(index, 1, 0)
            FindLastChange(index, -1, 0)
            FindLastChange(index, 0, 1)
            FindLastChange(index, 0, -1)
        } else if (Grid[index] == 0) {
            GameOver = false
        }
    }
    if (GameOver) {
        blockSettings.remove(FileName)
        game.gameOver(false)
    }
}
function RenderGrid (Src: Image) {
    for (let index = 0; index <= Gwidth * Gheight - 1; index++) {
        if (Grid[index] > 0) {
            RenderTile(Src, index, -1)
        }
    }
}
function MoveAndLoop (Dx: number, Dy: number, Loop: number) {
    for (let index = 0; index < Loop; index++) {
        MoveToMerge(Dx, Dy)
    }
}
spriteutils.createRenderable(600, function (screen2) {
    if (Booted) {
        if (Side.length == 0 && !(StartGame)) {
            if (BlackAndWhite) {
                spriteutils.drawTransparentImage(img`
                    ....333333333333333333333333........333333333333333333333333........333333333333333333333333........333333333333333333333333....
                    ..3311111111111111111111111133....3311111111111111111111111133....3311111111111111111111111133....3311111111111111111111111133..
                    .311111111111111111111111111113..311111111111111111111111111113..311111111111111111111111111113..311111111111111111111111111113.
                    .311333333333333333333333333113..311333333333333333333333333113..311333333333333333333333333113..311333333333333333333333333113.
                    31133333333333333333333333333113311333333333333333333333333331133113333333333333333333333333311331133333333333333333333333333113
                    31133333333333333333333333333113311333333333333333333333333331133113333333333333333333333333311331133333333333333333333333333113
                    31133333333333333333333333333113311333333333333333333333333331133113333333333333333333333333311331133333333333333333333333333113
                    31133333333333333333333333333113311333333333333333333333333331133113333333333333333333333333311331133333333333333333333333333113
                    31133333333333333333333333333113311333333333333333333333333331133113333333333333333333333333311331133333333333333333333333333113
                    31133333333333111133333333333113311333333333331111333333333331133113333333333333111333333333311331133333333333111133333333333113
                    31133333333311111111333333333113311333333333311111133333333331133113333333333333111333333333311331133333333311111111333333333113
                    31133333333311333311333333333113311333333333111331113333333331133113333333333331111333333333311331133333333311333311333333333113
                    31133333333113333331133333333113311333333333113333113333333331133113333333333331111333333333311331133333333113333331133333333113
                    31133333333113333331133333333113311333333331113333111333333331133113333333333311311333333333311331133333333113333331133333333113
                    31133333333333333311333333333113311333333331133333311333333331133113333333333311311333333333311331133333333111333311133333333113
                    31133333333333333111333333333113311333333331133333311333333331133113333333333113311333333333311331133333333311111111333333333113
                    31133333333333311113333333333113311333333331133333311333333331133113333333333113311333333333311331133333333311111111333333333113
                    31133333333331111333333333333113311333333331133333311333333331133113333333331133311333333333311331133333333111333311133333333113
                    31133333333311133333333333333113311333333331113333111333333331133113333333331133311333333333311331133333333113333331133333333113
                    31133333333111333333333333333113311333333333113333113333333331133113333333311111111113333333311331133333333113333331133333333113
                    31133333333113333333333333333113311333333333111331113333333331133113333333311111111113333333311331133333333311333311333333333113
                    31133333333111111111133333333113311333333333311111133333333331133113333333333333311333333333311331133333333311111111333333333113
                    31133333333111111111133333333113311333333333331111333333333331133113333333333333311333333333311331133333333333111133333333333113
                    31133333333333333333333333333113311333333333333333333333333331133113333333333333333333333333311331133333333333333333333333333113
                    31133333333333333333333333333113311333333333333333333333333331133113333333333333333333333333311331133333333333333333333333333113
                    31133333333333333333333333333113311333333333333333333333333331133113333333333333333333333333311331133333333333333333333333333113
                    31133333333333333333333333333113311333333333333333333333333331133113333333333333333333333333311331133333333333333333333333333113
                    31133333333333333333333333333113311333333333333333333333333331133113333333333333333333333333311331133333333333333333333333333113
                    .311333333333333333333333333113..311333333333333333333333333113..311333333333333333333333333113..311333333333333333333333333113.
                    .311111111111111111111111111113..311111111111111111111111111113..311111111111111111111111111113..311111111111111111111111111113.
                    ..3311111111111111111111111133....3311111111111111111111111133....3311111111111111111111111133....3311111111111111111111111133..
                    ....333333333333333333333333........333333333333333333333333........333333333333333333333333........333333333333333333333333....
                    `, screen2, 80 - 64, 22 - 16)
            } else {
                spriteutils.drawTransparentImage(img`
                    ....ffffffffffffffffffffffff........ffffffffffffffffffffffff........ffffffffffffffffffffffff........ffffffffffffffffffffffff....
                    ..ff111111111111111111111111ff....ff111111111111111111111111ff....ff111111111111111111111111ff....ff111111111111111111111111ff..
                    .f1111111111111111111111111111f..f1111111111111111111111111111f..f1111111111111111111111111111f..f1111111111111111111111111111f.
                    .f1122222222222222222222222211f..f11ffffffffffffffffffffffff11f..f1122222222222222222222222211f..f1133333333333333333333333311f.
                    f112222222222222222222222222211ff11ffffffffffffffffffffffffff11ff112222222222222222222222222211ff113333333333333333333333333311f
                    f112222222222222222222222222211ff11ffffffffffffffffffffffffff11ff112222222222222222222222222211ff113333333333333333333333333311f
                    f112222222222222222222222222211ff11ffffffffffffffffffffffffff11ff112222222222222222222222222211ff113333333333333333333333333311f
                    f112222222222222222222222222211ff11ffffffffffffffffffffffffff11ff112222222222222222222222222211ff113333333333333333333333333311f
                    f112222222222222222222222222211ff11ffffffffffffffffffffffffff11ff112222222222222222222222222211ff113333333333333333333333333311f
                    f112222222222211112222222222211ff11fffffffffff1111fffffffffff11ff112222222222222111222222222211ff113333333333311113333333333311f
                    f112222222221111111122222222211ff11ffffffffff111111ffffffffff11ff112222222222222111222222222211ff113333333331111111133333333311f
                    f112222222221122221122222222211ff11fffffffff111ff111fffffffff11ff112222222222221111222222222211ff113333333331133331133333333311f
                    f112222222211222222112222222211ff11fffffffff11ffff11fffffffff11ff112222222222221111222222222211ff113333333311333333113333333311f
                    f112222222211222222112222222211ff11ffffffff111ffff111ffffffff11ff112222222222211211222222222211ff113333333311333333113333333311f
                    f112222222222222221122222222211ff11ffffffff11ffffff11ffffffff11ff112222222222211211222222222211ff113333333311133331113333333311f
                    f112222222222222211122222222211ff11ffffffff11ffffff11ffffffff11ff112222222222112211222222222211ff113333333331111111133333333311f
                    f112222222222221111222222222211ff11ffffffff11ffffff11ffffffff11ff112222222222112211222222222211ff113333333331111111133333333311f
                    f112222222222111122222222222211ff11ffffffff11ffffff11ffffffff11ff112222222221122211222222222211ff113333333311133331113333333311f
                    f112222222221112222222222222211ff11ffffffff111ffff111ffffffff11ff112222222221122211222222222211ff113333333311333333113333333311f
                    f112222222211122222222222222211ff11fffffffff11ffff11fffffffff11ff112222222211111111112222222211ff113333333311333333113333333311f
                    f112222222211222222222222222211ff11fffffffff111ff111fffffffff11ff112222222211111111112222222211ff113333333331133331133333333311f
                    f112222222211111111112222222211ff11ffffffffff111111ffffffffff11ff112222222222222211222222222211ff113333333331111111133333333311f
                    f112222222211111111112222222211ff11fffffffffff1111fffffffffff11ff112222222222222211222222222211ff113333333333311113333333333311f
                    f112222222222222222222222222211ff11ffffffffffffffffffffffffff11ff112222222222222222222222222211ff113333333333333333333333333311f
                    f112222222222222222222222222211ff11ffffffffffffffffffffffffff11ff112222222222222222222222222211ff113333333333333333333333333311f
                    f112222222222222222222222222211ff11ffffffffffffffffffffffffff11ff112222222222222222222222222211ff113333333333333333333333333311f
                    f112222222222222222222222222211ff11ffffffffffffffffffffffffff11ff112222222222222222222222222211ff113333333333333333333333333311f
                    f112222222222222222222222222211ff11ffffffffffffffffffffffffff11ff112222222222222222222222222211ff113333333333333333333333333311f
                    .f1122222222222222222222222211f..f11ffffffffffffffffffffffff11f..f1122222222222222222222222211f..f1133333333333333333333333311f.
                    .f1111111111111111111111111111f..f1111111111111111111111111111f..f1111111111111111111111111111f..f1111111111111111111111111111f.
                    ..ff111111111111111111111111ff....ff111111111111111111111111ff....ff111111111111111111111111ff....ff111111111111111111111111ff..
                    ....ffffffffffffffffffffffff........ffffffffffffffffffffffff........ffffffffffffffffffffffff........ffffffffffffffffffffffff....
                    `, screen2, 80 - 64, 22 - 16)
            }
        }
    }
})
function MoveToMerge (Dx: number, Dy: number) {
    for (let index = 0; index <= Gwidth * Gheight - 1; index++) {
        TowardI = ScanInDirection(Dx, Dy, index)
        if (Grid[TowardI] > 0) {
            I = TowardI
            Tile = Grid[TowardI]
            Grid[TowardI] = 0
            while (Grid[I] == 0) {
                I += Dx
                I += Dy * Gwidth
                if (Grid[I] == 0) {
                    Grid[TowardI] = 0
                }
            }
            if (Grid[I] < 0 || Grid[I] != Tile) {
                I += 0 - Dx
                I += 0 - Dy * Gwidth
            }
            if (Grid[I] <= 0) {
                Grid[I] = Tile
            } else if (Grid[I] == Tile) {
                Grid[I] = Tile + 1
            }
        }
    }
}
function Newtable (SideIdx: number) {
    if (Side[SideIdx] == 0) {
        SetGridList(2, 1, 3, 3)
    } else if (Side[SideIdx] == 1) {
        SetGridList(2, 1, 4, 4)
    } else if (Side[SideIdx] == 2) {
        SetGridList(1, 0, 5, 5)
    } else {
        SetGridList(1, 0, 6, 6)
    }
    NewBlock()
}
spriteutils.createRenderable(500, function (screen2) {
    if (Booted) {
        if (BlackAndWhite) {
            screen2.replace(15, 3)
        }
    }
})
function RenderTile (Src: Image, Idx: number, Gap: number) {
    Gy = OffsetY * 16
    Gy += Math.floor(Idx / Gwidth) * 16
    Gx = OffsetX * 16
    Gx += Idx % Gwidth * 16
    Img = BlockTileList[Grid[Idx] + Gap].clone()
    if (!(BlackAndWhite)) {
        Img.replace(15, 2 + Math.floor((Grid[Idx] + Gap) / 2))
    }
    spriteutils.drawTransparentImage(Img, Src, Gx, Gy)
}
function LoadTable (Name: string) {
    SaveCode = blockSettings.readString(Name)
    Sidx = 0
    ReadNumber()
    SaveTime = Math.round(Val)
    ReadNumber()
    if (Val != 2048) {
        blockSettings.remove(Name)
        return
    }
    while (true) {
        ReadNumber()
        if (SaveValue.includes("0.")) {
            ReadModuleGrid()
        } else {
            if (SaveValue == "") {
                StartGame = true
                return
            }
            blockSettings.remove(Name)
            return
        }
    }
}
controller.right.onEvent(ControllerButtonEvent.Pressed, function () {
    if (StartGame) {
        GetAction(1, 0, 1)
    }
})
function SetGridList (OffX: number, OffY: number, Width: number, Height: number) {
    Gwidth = Width + 2
    Gheight = Height + 2
    OffsetX = OffX
    OffsetY = OffY
    Grid = []
    for (let index = 0; index < Gwidth; index++) {
        Grid.push(-1)
    }
    for (let index = 0; index < Gheight - 2; index++) {
        Grid.push(-1)
        for (let index = 0; index < Gwidth - 2; index++) {
            Grid.push(0)
        }
        Grid.push(-1)
    }
    for (let index = 0; index < Gwidth; index++) {
        Grid.push(-1)
    }
}
function SetupBackGround () {
    BackgroundList = [
    [
    assets.tile`myTile1`,
    assets.tile`myTile2`,
    assets.tile`myTile3`,
    assets.tile`myTile4`,
    assets.tile`myTile5`,
    assets.tile`myTile6`,
    assets.tile`myTile7`,
    assets.tile`myTile8`
    ],
    [
    assets.tile`myTile9`,
    assets.tile`myTile10`,
    assets.tile`myTile11`,
    assets.tile`myTile12`,
    assets.tile`myTile13`,
    assets.tile`myTile14`,
    assets.tile`myTile15`,
    assets.tile`myTile16`
    ],
    [
    assets.tile`myTile17`,
    assets.tile`myTile18`,
    assets.tile`myTile19`,
    assets.tile`myTile20`,
    assets.tile`myTile21`,
    assets.tile`myTile22`,
    assets.tile`myTile23`,
    assets.tile`myTile24`
    ],
    [
    assets.tile`myTile25`,
    assets.tile`myTile26`,
    assets.tile`myTile27`,
    assets.tile`myTile28`,
    assets.tile`myTile28`,
    assets.tile`myTile30`,
    assets.tile`myTile31`,
    assets.tile`myTile32`
    ],
    [
    assets.tile`myTile33`,
    assets.tile`myTile34`,
    assets.tile`myTile35`,
    assets.tile`myTile36`,
    assets.tile`myTile37`,
    assets.tile`myTile38`,
    assets.tile`myTile39`,
    assets.tile`myTile40`
    ]
    ]
    TickBackGround = 0
}
function WriteNumber (Val: number) {
    SaveValue = convertToText(Val)
    if (Val < 0) {
        SaveValue = "0" + convertToText(Math.abs(Val))
    }
    SaveCode = "" + SaveCode + SaveValue.length + SaveValue
}
function ScanInDirection (Dx: number, Dy: number, Idx: number) {
    if (Dy > 0) {
        TowardI = Gwidth * Gheight - 1 - Idx
    } else if (Dy < 0) {
        TowardI = Idx
    } else if (Dx < 0) {
        TowardI = Idx
        Gx = Math.floor(TowardI / Gheight)
        Gy = TowardI % Gheight
        TowardI = Gx
        TowardI += Gy * Gheight
    } else if (Dx > 0) {
        TowardI = Gwidth * Gheight - 1 - Idx
        Gx = Math.floor(TowardI / Gheight)
        Gy = TowardI % Gheight
        TowardI = Gx
        TowardI += Gy * Gheight
    }
    return TowardI
}
function WriteModuleGrid () {
    WriteNumber(0.1)
    WriteNumber(OffsetX)
    WriteNumber(OffsetY)
    WriteNumber(Gwidth)
    WriteNumber(Gheight)
    Gidx = 0
    Tile = Grid[Gidx]
    Count = 1
    for (let index = 0; index < Grid.length - 1; index++) {
        Gidx += 1
        if (Tile == Grid[Gidx]) {
            Count += 1
        } else {
            WriteNumber(Count)
            WriteNumber(Tile)
            Tile = Grid[Gidx]
            Count = 1
        }
    }
    WriteNumber(Count)
    WriteNumber(Tile)
    WriteNumber(-2048)
}
function InTitle (SideIdx: number) {
    if (!(TitleGame)) {
        if (SideIdx == -1) {
            TitleTick([
            miniMenu.createMenuItem("Start"),
            miniMenu.createMenuItem("Cradit"),
            miniMenu.createMenuItem("Theme"),
            miniMenu.createMenuItem("HowToPlay")
            ], "2048", 68, 72, 80, 80)
        } else if (SideIdx == 0) {
            if (Side[SideIdx] == 0) {
                TitleTick(ReadTheFile([
                "File1",
                "File2",
                "File3",
                "File4",
                "File5",
                "File6",
                "File7",
                "File8"
                ]), "Choose The File", 120, 100, 80, 60)
            } else if (Side[SideIdx] == 1) {
                game.showLongText("CreateBy:\\nSenaMena.inc\\nAssetBy:\\nSenaNaphatTH\\nCodeBy:\\nSenaNaphatTH\\n \\n \\nShowMore\\nPlatFrom[\\n Facebook:\\n NaphatSena\\n Tiktok@\\n naphatmaninil\\n Twitter(X)@\\n SenaNaphatTH\\n]\\nThankYou", DialogLayout.Center)
                Side.pop()
            } else if (Side[SideIdx] == 2) {
                TitleTick([miniMenu.createMenuItem("Color"), miniMenu.createMenuItem("B&W")], "ChooseTheTheme", 60, 48, 80, 60)
            } else if (Side[SideIdx] == 3) {
                game.showLongText("HowToPlay[\\nForComputer:\\nWASD to\\nMoveAllOfBlockInDirectionInTheTable\\nForJoyOrPhone:\\n UseJoyStick to\\n MoveAllOfBlockInDirectionOnTheTable\\n]", DialogLayout.Full)
                Side.pop()
            }
        } else if (SideIdx == 1) {
            FileName = Mitem
            if (!(FileName.includes("File"))) {
                blockSettings.writeNumber("Theme", Side[SideIdx])
                if (Side[SideIdx] == 0) {
                    BlackAndWhite = false
                } else {
                    BlackAndWhite = true
                }
                Side = []
                return
            }
            FileName = FileListName[Midx]
            if (blockSettings.exists(FileName)) {
                LoadTable(FileName)
            }
            if (!(blockSettings.exists(FileName))) {
                TitleTick([
                miniMenu.createMenuItem("33", img`
                    3333333333333333333.
                    31111131111131111131
                    31111131111131111131
                    31111131111131111131
                    31111131111131111131
                    31111131111131111131
                    33333333333333333331
                    31111131111131111131
                    31111131111131111131
                    31111131111131111131
                    31111131111131111131
                    31111131111131111131
                    33333333333333333331
                    31111131111131111131
                    31111131111131111131
                    31111131111131111131
                    31111131111131111131
                    31111131111131111131
                    33333333333333333331
                    .1111111111111111111
                    `),
                miniMenu.createMenuItem("44", img`
                    ....................
                    .33333333333333333..
                    .311131113111311131.
                    .311131113111311131.
                    .311131113111311131.
                    .333333333333333331.
                    .311131113111311131.
                    .311131113111311131.
                    .311131113111311131.
                    .333333333333333331.
                    .311131113111311131.
                    .311131113111311131.
                    .311131113111311131.
                    .333333333333333331.
                    .311131113111311131.
                    .311131113111311131.
                    .311131113111311131.
                    .333333333333333331.
                    ..11111111111111111.
                    ....................
                    `),
                miniMenu.createMenuItem("55", img`
                    ....................
                    ....................
                    ..3333333333333333..
                    ..31131131131131131.
                    ..31131131131131131.
                    ..33333333333333331.
                    ..31131131131131131.
                    ..31131131131131131.
                    ..33333333333333331.
                    ..31131131131131131.
                    ..31131131131131131.
                    ..33333333333333331.
                    ..31131131131131131.
                    ..31131131131131131.
                    ..33333333333333331.
                    ..31131131131131131.
                    ..31131131131131131.
                    ..33333333333333331.
                    ...1111111111111111.
                    ....................
                    `),
                miniMenu.createMenuItem("66", img`
                    3333333333333333333.
                    31131131131131131131
                    31131131131131131131
                    33333333333333333331
                    31131131131131131131
                    31131131131131131131
                    33333333333333333331
                    31131131131131131131
                    31131131131131131131
                    33333333333333333331
                    31131131131131131131
                    31131131131131131131
                    33333333333333333331
                    31131131131131131131
                    31131131131131131131
                    33333333333333333331
                    31131131131131131131
                    31131131131131131131
                    33333333333333333331
                    .1111111111111111111
                    `)
                ], "ChooseSizeOfTable", 80, 90, 80, 60)
            }
        } else if (SideIdx == 2) {
            Newtable(SideIdx)
            StartGame = true
        }
    }
    timer.background(function () {
        if (TitleGame) {
            TitleGame.onButtonPressed(controller.A, function (selection, selectedIndex) {
                Mitem = selection
                Midx = selectedIndex
                Choosed = true
                sprites.destroy(TitleGame)
                TitleGame.close()
            })
            if (SideIdx > -1) {
                TitleGame.onButtonPressed(controller.B, function (selection, selectedIndex) {
                    Back = true
                    sprites.destroy(TitleGame)
                    TitleGame.close()
                })
            }
            if (Choosed) {
                Side.push(Midx)
                TitleGame = spriteutils.nullConsts(spriteutils.NullConsts.Undefined)
            } else if (Back) {
                Side.pop()
                TitleGame = spriteutils.nullConsts(spriteutils.NullConsts.Undefined)
            }
        }
    })
}
function NewBlock () {
    while (true) {
        Gamount = 0
        for (let index = 0; index <= Gwidth * Gheight - 1; index++) {
            if (Math.abs(Grid[index]) > 0) {
                Gamount += 1
            } else if (Grid[index] == 0) {
                if (Math.percentChance(1)) {
                    Grid[index] = randint(1, 2)
                    return
                }
            }
        }
        if (Gamount >= Grid.length) {
            return
        }
    }
}
function ReadTheFile (MyFile: string[]) {
    FileListName = MyFile
    FileMenu = []
    for (let value of FileListName) {
        if (blockSettings.exists(value)) {
            SaveCode = blockSettings.readString(value)
            Sidx = 0
            ReadNumber()
            Val = Math.round(Val / 1000)
            FileMenu.push(miniMenu.createMenuItem("" + value + ":" + Math.floor(Val / 60) + ":" + Val % 60, img`
                . 1 1 1 1 1 . . . . . . . . . . 
                1 1 3 3 3 3 1 . . . . . . . . . 
                1 3 1 1 1 1 3 1 1 1 1 1 1 1 1 . 
                1 3 1 3 3 3 1 3 3 3 3 3 3 3 1 1 
                1 3 1 3 3 3 3 1 1 1 1 1 1 1 3 1 
                1 3 1 3 3 3 3 3 3 3 3 3 3 1 3 1 
                1 3 1 3 3 3 3 3 3 3 3 3 3 1 3 1 
                1 3 1 3 3 3 3 3 3 3 3 3 3 1 3 1 
                1 3 1 3 3 3 3 3 3 3 3 3 3 1 3 1 
                1 3 1 3 3 3 3 3 3 3 3 3 3 1 3 1 
                1 3 1 3 3 3 3 3 3 3 3 3 3 1 3 1 
                1 3 1 3 3 3 3 3 3 3 3 3 3 1 3 1 
                1 3 1 3 3 3 3 3 3 3 3 3 3 1 3 1 
                1 3 1 1 1 1 1 1 1 1 1 1 1 1 3 1 
                1 1 3 3 3 3 3 3 3 3 3 3 3 3 1 1 
                . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
                `))
        } else {
            FileMenu.push(miniMenu.createMenuItem(value, img`
                . 1 1 1 1 1 . . . . . . . . . . 
                1 1 3 3 3 3 1 . . . . . . . . . 
                1 3 1 1 1 1 3 1 1 1 1 1 1 1 1 . 
                1 3 1 1 1 1 1 3 3 3 3 3 3 3 1 1 
                1 3 1 1 1 1 1 1 1 1 1 1 1 1 3 1 
                1 3 1 1 1 1 1 1 1 1 1 1 1 1 3 1 
                1 3 1 1 1 1 1 1 1 1 1 1 1 1 3 1 
                1 3 1 1 1 1 1 1 1 1 1 1 1 1 3 1 
                1 3 1 1 1 1 1 1 1 1 1 1 1 1 3 1 
                1 3 1 1 1 1 1 1 1 1 1 1 1 1 3 1 
                1 3 1 1 1 1 1 1 1 1 1 1 1 1 3 1 
                1 3 1 1 1 1 1 1 1 1 1 1 1 1 3 1 
                1 3 1 1 1 1 1 1 1 1 1 1 1 1 3 1 
                1 3 1 1 1 1 1 1 1 1 1 1 1 1 3 1 
                1 1 3 3 3 3 3 3 3 3 3 3 3 3 1 1 
                . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
                `))
        }
    }
    return FileMenu
}
function ReadModuleGrid () {
    ReadNumber()
    OffsetX = Math.round(Val)
    ReadNumber()
    OffsetY = Math.round(Val)
    ReadNumber()
    Gwidth = Math.round(Val)
    ReadNumber()
    Gheight = Math.round(Val)
    Grid = []
    ReadNumber()
    while (Val != -2048) {
        Count = Val
        ReadNumber()
        for (let index = 0; index < Count; index++) {
            Grid.push(Val)
        }
        ReadNumber()
    }
}
controller.menu.onEvent(ControllerButtonEvent.Pressed, function () {
    game.showLongText("FactoryReset", DialogLayout.Center)
    blockSettings.clear()
    game.reset()
})
controller.left.onEvent(ControllerButtonEvent.Pressed, function () {
    if (StartGame) {
        GetAction(-1, 0, 1)
    }
})
function TitleTick (Menu: any[], Name: string, Wd: number, Hi: number, X: number, Y: number) {
    CreateTitleGame(Menu, Wd, Hi, Name, X, Y)
    Choosed = false
    Back = false
}
function FindLastChange (Idx: number, Dx: number, Dy: number) {
    EdgeI = Idx + Dx
    EdgeI += Dy * Gwidth
    if (Grid[Idx] == Grid[EdgeI]) {
        GameOver = false
    }
}
function SetupBlock () {
    BlockTileList = [
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f 1 1 f f f f f f 1 
        1 f f f f f 1 f f 1 f f f f f 1 
        1 f f f f f f f f 1 f f f f f 1 
        1 f f f f f f f 1 f f f f f f 1 
        1 f f f f f f 1 f f f f f f f 1 
        1 f f f f f 1 1 1 1 f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f 1 f f f f f 1 
        1 f f f f f f f 1 1 f f f f f 1 
        1 f f f f f f 1 f 1 f f f f f 1 
        1 f f f f f 1 f f 1 f f f f f 1 
        1 f f f f f 1 1 1 1 f f f f f 1 
        1 f f f f f f f f 1 f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f 1 1 f f f f f f 1 
        1 f f f f f 1 f f 1 f f f f f 1 
        1 f f f f f f 1 1 f f f f f f 1 
        1 f f f f f 1 f f 1 f f f f f 1 
        1 f f f f f 1 f f 1 f f f f f 1 
        1 f f f f f f 1 1 f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 f f f f f 1 1 f f f 1 
        1 f f 1 1 f f f f 1 f f 1 f f 1 
        1 f f f 1 f f f f 1 1 1 f f f 1 
        1 f f f 1 f f f f 1 f f 1 f f 1 
        1 f f f 1 f f f f 1 f f 1 f f 1 
        1 f f 1 1 1 f f f f 1 1 f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 f f f f 1 1 f f f 1 
        1 f f 1 f f 1 f f 1 f f 1 f f 1 
        1 f f f f 1 f f f f f f 1 f f 1 
        1 f f f f f 1 f f f f 1 f f f 1 
        1 f f 1 f f 1 f f f 1 f f f f 1 
        1 f f f 1 1 f f f 1 1 1 1 f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 f f f f f f 1 f f 1 
        1 f f 1 f f 1 f f f f 1 1 f f 1 
        1 f f 1 1 1 f f f f 1 f 1 f f 1 
        1 f f 1 f f 1 f f 1 f f 1 f f 1 
        1 f f 1 f f 1 f f 1 1 1 1 f f 1 
        1 f f f 1 1 f f f f f f 1 f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 f f f f f 1 1 f f f 1 
        1 f f 1 1 f f f f 1 f f 1 f f 1 
        1 f f f 1 f f f f f f 1 f f f 1 
        1 f f f 1 f f f f f 1 f f f f 1 
        1 f f 1 1 1 f f f 1 1 1 1 f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 f f f f f f f f f 1 
        1 f f 1 f f 1 f f f f f f f f 1 
        1 f f f 1 1 f f f f f f f f f 1 
        1 f f 1 f f 1 f f f f f f f f 1 
        1 f f f 1 1 f f f f f f f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 f f f 1 1 1 1 f f 1 
        1 f f 1 f f 1 f f 1 f f f f f 1 
        1 f f f f 1 f f f 1 1 1 f f f 1 
        1 f f f 1 f f f f f f f 1 f f 1 
        1 f f 1 1 1 1 f f 1 1 1 f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 1 f f f f f f f f 1 
        1 f f 1 f f f f f f f f f f f 1 
        1 f f 1 1 1 f f f f f f f f f 1 
        1 f f 1 f f 1 f f f f f f f f 1 
        1 f f f 1 1 f f f f f f f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f 1 1 1 1 f f f 1 f f f f 1 
        1 f f 1 f f f f f 1 1 f f f f 1 
        1 f f 1 1 1 f f f f 1 f f f f 1 
        1 f f f f f 1 f f f 1 f f f f 1 
        1 f f 1 1 1 f f f 1 1 1 f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 f f f f f f f f f 1 
        1 f f 1 f f 1 f f f f f f f f 1 
        1 f f f f 1 f f f f f f f f f 1 
        1 f f f 1 f f f f f f f f f f 1 
        1 f f 1 1 1 1 f f f f f f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 f f f f f 1 1 f f f 1 
        1 f f 1 1 f f f f 1 f f 1 f f 1 
        1 f f f 1 f f f f 1 f f 1 f f 1 
        1 f f f 1 f f f f 1 f f 1 f f 1 
        1 f f 1 1 1 f f f f 1 1 f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 f f f f f 1 f f f 1 
        1 f f 1 f f 1 f f f 1 1 f f f 1 
        1 f f f f 1 f f f 1 f 1 f f f 1 
        1 f f f 1 f f f f 1 1 1 1 f f 1 
        1 f f 1 1 1 1 f f f f 1 f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 f f f f 1 1 f f f 1 
        1 f f 1 f f 1 f f 1 f f 1 f f 1 
        1 f f f f 1 f f f 1 f f 1 f f 1 
        1 f f f 1 f f f f 1 f f 1 f f 1 
        1 f f 1 1 1 1 f f f 1 1 f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f 1 f f f f 1 1 f f f 1 
        1 f f f 1 1 f f f 1 f f 1 f f 1 
        1 f f 1 f 1 f f f f 1 1 f f f 1 
        1 f f 1 1 1 1 f f 1 f f 1 f f 1 
        1 f f f f 1 f f f f 1 1 f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f 1 f f f f 1 1 f f f 1 
        1 f f f 1 1 f f f 1 f f 1 f f 1 
        1 f f 1 f 1 f f f 1 f f 1 f f 1 
        1 f f 1 1 1 1 f f 1 f f 1 f f 1 
        1 f f f f 1 f f f f 1 1 f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 f f f f 1 1 1 f f 1 
        1 f f 1 f f 1 f f 1 f f f f f 1 
        1 f f f 1 1 1 f f 1 1 1 f f f 1 
        1 f f f f f 1 f f 1 f f 1 f f 1 
        1 f f 1 1 1 f f f f 1 1 f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 f f f f 1 f f f f 1 
        1 f f 1 f f 1 f f 1 1 f f f f 1 
        1 f f f 1 1 f f f f 1 f f f f 1 
        1 f f 1 f f 1 f f f 1 f f f f 1 
        1 f f f 1 1 f f f 1 1 1 f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 f f f f 1 1 f f f 1 
        1 f f 1 f f 1 f f 1 f f 1 f f 1 
        1 f f f 1 1 1 f f f f 1 f f f 1 
        1 f f f f f 1 f f f 1 f f f f 1 
        1 f f 1 1 1 f f f 1 1 1 1 f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 f f f 1 f f 1 f f 1 
        1 f f 1 f f 1 f f 1 f 1 f f f 1 
        1 f f f f f 1 f f 1 1 f f f f 1 
        1 f f f f 1 f f f 1 1 f f f f 1 
        1 f f f 1 f f f f 1 f 1 f f f 1 
        1 f f 1 1 1 1 f f 1 f f 1 f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f 1 f f 1 f f 1 f f 1 
        1 f f f f 1 1 f f 1 f 1 f f f 1 
        1 f f f 1 f 1 f f 1 1 f f f f 1 
        1 f f 1 f f 1 f f 1 1 f f f f 1 
        1 f f 1 1 1 1 f f 1 f 1 f f f 1 
        1 f f f f f 1 f f 1 f f 1 f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 f f f 1 f f 1 f f 1 
        1 f f 1 f f 1 f f 1 f 1 f f f 1 
        1 f f f 1 1 f f f 1 1 f f f f 1 
        1 f f 1 f f 1 f f 1 1 f f f f 1 
        1 f f 1 f f 1 f f 1 f 1 f f f 1 
        1 f f f 1 1 f f f 1 f f 1 f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 f f f f f 1 1 1 f f 1 
        1 f f 1 1 f f f f 1 f f f f f 1 
        1 f f f 1 f f f f 1 1 1 f f f 1 
        1 f f f 1 f f f f 1 f f 1 f f 1 
        1 f f 1 1 1 f f f f 1 1 f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f 1 f f 1 f f f f f f f f 1 
        1 f f 1 f 1 f f f f f f f f f 1 
        1 f f 1 1 f f f f f f f f f f 1 
        1 f f 1 f 1 f f f f f f f f f 1 
        1 f f 1 f f 1 f f f f f f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 f f f f 1 1 f f f 1 
        1 f f 1 f f 1 f f 1 f f 1 f f 1 
        1 f f f f 1 f f f f f 1 f f f 1 
        1 f f 1 f f 1 f f f 1 f f f f 1 
        1 f f f 1 1 f f f 1 1 1 1 f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f 1 f f 1 f f f f f f f f 1 
        1 f f 1 f 1 f f f f f f f f f 1 
        1 f f 1 1 f f f f f f f f f f 1 
        1 f f 1 f 1 f f f f f f f f f 1 
        1 f f 1 f f 1 f f f f f f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 1 f f f f 1 f f f 1 
        1 f f 1 f f f f f f 1 1 f f f 1 
        1 f f 1 1 1 f f f 1 f 1 f f f 1 
        1 f f 1 f f 1 f f 1 1 1 1 f f 1 
        1 f f f 1 1 f f f f f 1 f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f 1 f f 1 f f f f f f f f 1 
        1 f f 1 f 1 f f f f f f f f f 1 
        1 f f 1 1 f f f f f f f f f f 1 
        1 f f 1 f 1 f f f f f f f f f 1 
        1 f f 1 f f 1 f f f f f f f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 f f f f f 1 1 f f f 1 
        1 f f 1 1 f f f f 1 f f 1 f f 1 
        1 f f f 1 f f f f f f 1 f f f 1 
        1 f f f 1 f f f f f 1 f f f f 1 
        1 f f 1 1 1 f f f 1 1 1 1 f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 f f f 1 f f 1 f f 1 
        1 f f 1 f f 1 f f 1 f 1 f f f 1 
        1 f f f 1 1 f f f 1 1 f f f f 1 
        1 f f 1 f f 1 f f 1 f 1 f f f 1 
        1 f f f 1 1 f f f 1 f f 1 f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 f f f 1 1 1 1 f f 1 
        1 f f 1 f f 1 f f 1 f f f f f 1 
        1 f f f f 1 f f f 1 1 1 f f f 1 
        1 f f f 1 f f f f f f f 1 f f 1 
        1 f f 1 1 1 1 f f 1 1 1 f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 1 f f 1 f f 1 f f 1 
        1 f f 1 f f f f f 1 f 1 f f f 1 
        1 f f 1 1 1 f f f 1 1 f f f f 1 
        1 f f 1 f f 1 f f 1 f 1 f f f 1 
        1 f f f 1 1 f f f 1 f f 1 f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `,
    img`
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        1 1 f f f f f f f f f f f f 1 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f 1 1 1 1 f f f 1 f f f f 1 
        1 f f 1 f f f f f 1 1 f f f f 1 
        1 f f 1 1 1 f f f f 1 f f f f 1 
        1 f f f f f 1 f f f 1 f f f f 1 
        1 f f 1 1 1 f f f 1 1 1 f f f 1 
        1 f f f f f f f f f f f f f f 1 
        1 f f f 1 1 f f f 1 f f 1 f f 1 
        1 f f 1 f f 1 f f 1 f 1 f f f 1 
        1 f f f f 1 f f f 1 1 f f f f 1 
        1 f f f 1 f f f f 1 f 1 f f f 1 
        1 f f 1 1 1 1 f f 1 f f 1 f f 1 
        1 1 f f f f f f f f f f f f 1 1 
        . 1 1 1 1 1 1 1 1 1 1 1 1 1 1 . 
        `
    ]
}
controller.up.onEvent(ControllerButtonEvent.Pressed, function () {
    if (StartGame) {
        GetAction(0, -1, 1)
    }
})
controller.down.onEvent(ControllerButtonEvent.Pressed, function () {
    if (StartGame) {
        GetAction(0, 1, 1)
    }
})
function CreateTitleGame (Menu: any[], Wd: number, He: number, Name: string, X: number, Y: number) {
    TitleGame = miniMenu.createMenuFromArray(Menu)
    TitleGame.setDimensions(Wd, He)
    TitleGame.setTitle(Name)
    TitleGame.setFrame(img`
        111111......111111
        1ffff11111111ffff1
        1f11ffffffffff11f1
        1f11f11f11f11f11f1
        1ffffffffffffffff1
        11f1f11111111f1f11
        .1f1f11111111f1f1.
        .1fff11111111fff1.
        .1f1f11111111f1f1.
        .1f1f11111111f1f1.
        .1fff11111111fff1.
        .1f1f11111111f1f1.
        11f1f11111111f1f11
        1ffffffffffffffff1
        1f11f11f11f11f11f1
        1f11ffffffffff11f1
        1ffff11111111ffff1
        111111......111111
        `)
    TitleGame.setPosition(X, Y)
}
let TickFloor = 0
let TickBackList = 0
let EdgeI = 0
let FileMenu: miniMenu.MenuItem[] = []
let Gamount = 0
let Back = false
let Choosed = false
let Midx = 0
let FileListName: string[] = []
let Mitem = ""
let TitleGame: miniMenu.MenuSprite = null
let Count = 0
let Gidx = 0
let TickBackGround = 0
let BackgroundList: Image[][] = []
let BlockTileList: Image[] = []
let Img: Image = null
let Tile = 0
let I = 0
let TowardI = 0
let FileName = ""
let GameOver = false
let Grid: number[] = []
let OffsetX = 0
let Gx = 0
let OffsetY = 0
let Gy = 0
let Gheight = 0
let Gwidth = 0
let C = ""
let Sidx = 0
let Sloop = 0
let SaveValue = ""
let Val = 0
let StartTime = 0
let SaveTime = 0
let SaveCode = ""
let Booted = false
let Side: number[] = []
let BlackAndWhite = false
let StartGame = false
Bootup()
StartGame = false
if (blockSettings.exists("Theme")) {
    if (blockSettings.readNumber("Theme") == 0) {
        BlackAndWhite = false
    } else {
        BlackAndWhite = true
    }
} else {
    BlackAndWhite = false
}
Side = []
SetupBackGround()
SetupBlock()
tiles.loadMap(tiles.createMap(tilemap`level2`))
game.onUpdate(function () {
    if (BlackAndWhite) {
        game.setDialogTextColor(3)
        game.setDialogCursor(img`
            . . . . 3 3 3 . . . . 
            . . 3 3 1 1 1 3 3 . . 
            . 3 1 1 1 1 1 1 1 3 . 
            . 3 1 1 3 3 3 1 1 3 . 
            3 1 1 1 3 1 3 1 1 1 3 
            3 1 1 1 3 3 3 1 1 1 3 
            3 1 1 1 3 1 3 1 1 1 3 
            . 3 1 1 3 1 3 1 1 3 . 
            . 3 1 1 1 1 1 1 1 3 . 
            . . 3 3 1 1 1 3 3 . . 
            . . . . 3 3 3 . . . . 
            `)
        game.setDialogFrame(img`
            111111......111111
            133331111111133331
            131133333333331131
            131131131131131131
            133333333333333331
            113131111111131311
            .1313111111113131.
            .1333111111113331.
            .1313111111113131.
            .1313111111113131.
            .1333111111113331.
            .1313111111113131.
            113131111111131311
            133333333333333331
            131131131131131131
            131133333333331131
            133331111111133331
            111111......111111
            `)
    } else {
        game.setDialogTextColor(15)
        game.setDialogCursor(img`
            . . . . f f f . . . . 
            . . f f 1 1 1 f f . . 
            . f 1 1 1 1 1 1 1 f . 
            . f 1 1 f f f 1 1 f . 
            f 1 1 1 f 1 f 1 1 1 f 
            f 1 1 1 f f f 1 1 1 f 
            f 1 1 1 f 1 f 1 1 1 f 
            . f 1 1 f 1 f 1 1 f . 
            . f 1 1 1 1 1 1 1 f . 
            . . f f 1 1 1 f f . . 
            . . . . f f f . . . . 
            `)
        game.setDialogFrame(img`
            111111......111111
            1ffff11111111ffff1
            1f11ffffffffff11f1
            1f11f11f11f11f11f1
            1ffffffffffffffff1
            11f1f11111111f1f11
            .1f1f11111111f1f1.
            .1fff11111111fff1.
            .1f1f11111111f1f1.
            .1f1f11111111f1f1.
            .1fff11111111fff1.
            .1f1f11111111f1f1.
            11f1f11111111f1f11
            1ffffffffffffffff1
            1f11f11f11f11f11f1
            1f11ffffffffff11f1
            1ffff11111111ffff1
            111111......111111
            `)
    }
    if (StartGame) {
        SaveTable(FileName)
    } else {
        InTitle(Side.length - 1)
    }
})
game.onUpdateInterval(100, function () {
    TickBackList = TickBackGround % (BackgroundList.length * 8)
    TickFloor = Math.floor(TickBackGround / 8) % 5
    for (let value of tiles.getTilesByType(BackgroundList[TickFloor][TickBackList % 8])) {
        tiles.setTileAt(value, BackgroundList[Math.floor((TickBackGround + 1) / 8) % 5][(TickBackList + 1) % 8])
    }
    TickBackGround += 1
})
game.onUpdate(function () {
    PaintTable()
})
